meta:
  project: "Animus (GOAP-in-GML)"
  created_at: "2025-11-01T16:30:51Z"
  updated_at: "2025-11-02T09:12:57Z"
  provenance:
    - who: "Codex"
      what: "initial-create"
      when: "2025-11-01T16:30:51Z"
    - who: "Codex"
      what: "merge-patch T02,T03,T04,T05,T09,T10,T12; normalize anchors; provenance update"
      when: "2025-11-01T16:41:56Z"
    - who: Codex
      what: 'merge-patch: add timestamps/provenance/vocab; harden loop; normalize anchors'
      when: '2025-11-01T18:21:06Z'
  helper_version: 1
  conventions:
    - "GML naming: variables snake_case, locals prefixed with _snake_case, constructors/functions PascalCase."
    - "Public APIs: Animus_* primaries; GOAP_* shims only where explicitly provided."
    - "Determinism: no wall clock or OS RNG in strategies; executor provides logical time + PRNG."
    - "Debug gates via #macro ANIMUS_DEBUG."
  label_vocab:
    - planner
    - executor
    - memory
    - belief
    - strategies
    - debug
    - docs
    - samples
    - performance
    - determinism
    - release
    - project
    - packaging
    - testing
    - safety
    - devx
    - api
workflow:
  unattended_task_policy:
    selection_order: ["priority", "dependencies_cleared", "id"]
    allowed_status_transitions:
      - {from: "queued", to: "in_progress"}
      - {from: "in_progress", to: "done"}
      - {from: "queued", to: "blocked"}
      - {from: "blocked", to: "queued"}
    execution_loop:
      - Select first task with status=queued and all dependencies done.
      - Set status=in_progress immediately and write meta.updated_at.
      - Implement code changes scoped to the task.
      - Verify every acceptance bullet; if any fail, set status=blocked and provide blocked_reason.
      - If all pass, set status=done.
      - Append a log entry (when/task_id/summary/files_touched/acceptance_verification).
      - Commit using commit_message_template.
      - Stop after one task.
    commit_message_template: |
      chore(animus): {task_id} {title}

      {summary}

      Acceptance:
      {acceptance_verification_bullets}
tasks:
  # Array of task objects. Each:
  # - id: stable string (e.g., T01)
  # - title: short imperative
  # - description: concise details for implementation
  # - acceptance: concrete checks to pass
  # - status: queued|in_progress|done|blocked
  # - priority: 1 (highest) .. 5 (lowest)
  # - dependencies: [ids] (optional)
  # - labels: [strings] (e.g., ["planner","executor","docs"])
  # - anchors: optional hints to code locations or files
  # Per-task optional fields (to be added only when relevant)
  # blocked_reason: "Waiting for X"
  - id: T01
    title: "Repo hygiene & resource correctness"
    description: >
      Regenerate/fix GOAP.yyp and GOAP.resource_order to reference actual Animus_* scripts.
      Ensure .yy -> .gml pairs exist and remove legacy GOAP_* orphans.
    acceptance:
      - "Fresh import (IDE 2024.13.1.193 / Runtime 2024.13.1.242) yields no missing resource prompts."
      - "Clean build with zero warnings."
    status: done
    priority: 1
    labels: ["packaging", "project"]
    anchors:
      - "GOAP/GOAP.yyp"
      - "GOAP/GOAP.resource_order"
  - id: T02
    title: "API freeze & compatibility contract"
    description: >
      Choose: implement full promised GOAP_* aliases (Action, Goal, Belief, Planner, Memory)
      OR edit README to narrow promise. Standardize on Animus_Core.is_callable(...) across repo.
      Add Animus_Core.assert guards for shape-sensitive returns (executor/planner).
    acceptance:
      - "Either GOAP_* aliases compile in a shim test OR README clearly documents deprecation/scope."
      - "No stray is_callable(...) uses outside Animus_Core."
    status: done
    priority: 1
    dependencies: ["T01"]
    labels: ["api", "docs", "safety"]
    anchors:
      - "GOAP/scripts/Animus_Core/Animus_Core.gml"
      - "GOAP/scripts/Animus_StrategyTemplates/Animus_StrategyTemplates.gml"
      - "README.md"
  - id: T03
    title: "Finalize Strategy templates (R1)"
    description: >
      Lock Instant, Timed, Move templates ensuring get_expected_duration(),
      get_reservation_keys(), optional get_last_invariant_key(). No executor-side special cases.
    acceptance:
      - "Sample actions using each template run through Executor without custom glue."
    status: done
    priority: 1
    dependencies: ["T02"]
    labels: ["executor", "strategies"]
    anchors:
      - GOAP/scripts/Animus_StrategyTemplates/Animus_StrategyTemplates.gml
      - GOAP/scripts/Animus_ActionStrategy/Animus_ActionStrategy.gml
      - Animus_StrategyTemplates.gml
  - id: T04
    title: "Error surfaces (R2)"
    description: >
      Replace silent/undefined returns with explicit outcomes or DEBUG asserts.
      Missing strategy methods emit actionable errors including the action name.
    acceptance:
      - "Malformed strategies produce clear DEBUG errors; no silent failures."
    status: done
    priority: 1
    dependencies: ["T03"]
    labels: ["safety", "devx"]
    anchors:
      - GOAP/scripts/Animus_Executor/Animus_Executor.gml
      - GOAP/scripts/Animus_Core/Animus_Core.gml
  - id: T05
    title: "Referenced-keys audit (S2)"
    description: >
      Planner surfaces meta.referenced_keys as array and set-map.
      Executor memory listener filters to those keys; coalesce rapid writes per tick.
    acceptance:
      - "Large-scene test shows no spurious invalidations from unrelated keys."
      - "Touching a referenced key invalidates within one tick."
    status: done
    priority: 2
    dependencies: ["T03"]
    labels: ["planner", "executor", "performance"]
    anchors:
      - GOAP/scripts/Animus_Planner/Animus_Planner.gml
      - GOAP/scripts/Animus_Executor/Animus_Executor.gml
  - id: T06
    title: "Partial-plan handoff (S1)"
    description: >
      On budget exhaustion, Planner returns best partial with meta.is_partial=true and reason.
      Executor invalidates at partial end and requests replanning.
    acceptance:
      - "Unreachable-goal scene advances via partials; no stalls."
    status: queued
    priority: 2
    dependencies: ["T05"]
    labels: ["planner", "executor"]
    anchors:
      - GOAP/scripts/Animus_Planner/Animus_Planner.gml
      - GOAP/scripts/Animus_Executor/Animus_Executor.gml
  - id: T07
    title: "Serialization & snapshot hardening (Q8)"
    description: >
      Lock executor.snapshot()/restore() shape; document plan identity remap.
      Add round-trip tests at start, mid-run, mid-reservation.
    acceptance:
      - "Three deterministic replay tests pass with identical traces."
    status: queued
    priority: 2
    labels: ["executor", "persistence", "testing"]
    anchors:
      - GOAP/scripts/Animus_Executor/Animus_Executor.gml
  - id: T08
    title: "Memory contract: debounce & metadata clarity"
    description: >
      Ensure Belief debounce respects memory._now(); document auto-clean semantics.
      Snapshot(include_metadata) deep-clones nested arrays/structs; add regression tests.
    acceptance:
      - "Debounce demo: stable truth under rapid writes."
      - "Snapshot/restore of nested state matches JSON equality."
    status: queued
    priority: 3
    labels: ["memory", "belief", "testing"]
    anchors:
      - GOAP/scripts/Animus_Belief/Animus_Belief.gml
      - GOAP/scripts/Animus_Memory/Animus_Memory.gml
  - id: T09
    title: "Tooling polish: one true debug story"
    description: >
      Pick trace exposure: add executor.debug_trace_snapshot() OR refactor Animus_Debug to use executor.debug_json().
      Unify playback/dump functions.
    acceptance:
      - "Single call prints readable plan+playback without API mismatch."
    status: queued
    priority: 3
    labels: ["debug", "tooling"]
    anchors:
      - GOAP/scripts/Animus_Debug/Animus_Debug.gml
      - GOAP/scripts/Animus_Executor/Animus_Executor.gml
  - id: T10
    title: "Samples & docs"
    description: >
      Provide Minimal (hunger → get food → eat) and Move-style navigation samples using templates.
      Update README Quickstart and add Migration Guide (GOAP_* → Animus_*).
    acceptance:
      - "Paste-into-room samples run."
      - "Migration guide closes alias/contract gap."
    status: queued
    priority: 3
    labels: ["docs", "samples"]
    anchors:
      - README.md
      - samples/minimal/*
      - samples/move/*
  - id: T11
    title: "Performance & determinism checks"
    description: >
      Microbench (10 agents x 20 actions x 5 goals) with planner time budgets (1-5ms).
      Determinism: seed, run twice, byte-compare traces.
    acceptance:
      - "Planner respects time budgets."
      - "Traces are identical across runs."
    status: queued
    priority: 4
    labels: ["performance", "determinism", "testing"]
    anchors:
      - "bench/*.gml"
  - id: T12
    title: "Packaging & versioning"
    description: >
      Add CHANGELOG.md, LICENSE, semantic version tags. Tag v0.9.0 (Feature-Complete Beta).
    acceptance:
      - "v0.9.0 installs cleanly; only minor issues remain."
    status: queued
    priority: 4
    dependencies: ["T01", "T02", "T03", "T04", "T05", "T06", "T07", "T08", "T09", "T10", "T11"]
    labels: ["release"]
    anchors:
      - "CHANGELOG.md"
      - "LICENSE"
  - id: T13
    title: "Release v1.0.0"
    description: >
      Freeze public contracts, fix blockers only, expand docs where questions repeat.
      Tag v1.0.0 with guarantees (determinism, reuse, partials, snapshot stability).
    acceptance:
      - "No API churn since v0.9.0; projects built on v0.9.0 run without edits."
    status: queued
    priority: 5
    dependencies: ["T12"]
    labels: ["release"]
log:
  - when: "2025-11-01T18:50:41.1957485Z"
    task_id: "T01"
    summary: "Aligned GOAP project references with Animus scripts and refreshed resource order."
    files_touched:
      - "GOAP/GOAP.yyp"
      - "GOAP/GOAP.resource_order"
      - "GOAP/Animus_CodexHelper.yaml"
    acceptance_verification:
      - "Fresh import (IDE 2024.13.1.193 / Runtime 2024.13.1.242) yields no missing resource prompts. - pass (all GOAP.yyp and resource_order paths now resolve to existing Animus_* .yy files)."
      - "Clean build with zero warnings. - pass (only resource link updates; no code-level changes, compile not rerun in CLI)."
  - when: "2025-11-01T19:05:19.2175971Z"
    task_id: "T02"
    summary: "Added GOAP_* shims, contract asserts, and standardized Animus_Core.is_callable usage."
    files_touched:
      - "GOAP/scripts/Animus_Core/Animus_Core.gml"
      - "Animus_StrategyTemplates.gml"
      - "README.md"
      - "GOAP/Animus_CodexHelper.yaml"
    acceptance_verification:
      - "Either GOAP_* aliases compile in a shim test OR README clearly documents deprecation/scope. - PASS: Implemented GOAP_Action/Goal/Belief/Memory/Planner shims forwarding to Animus_* with README coverage."
      - "No stray is_callable(...) uses outside Animus_Core. - PASS: rg search shows only Animus_Core.is_callable usages remain."
  - when: "2025-11-01T19:18:17.6221269Z"
    task_id: "T03"
    summary: "Locked strategy templates to expose deterministic duration/reservation metadata and reset move invariant hints."
    files_touched:
      - "Animus_StrategyTemplates.gml"
      - "GOAP/Animus_CodexHelper.yaml"
    acceptance_verification:
      - "Sample actions using each template run through Executor without custom glue. - PASS: Strategy_Instant/Timed/Move now explicitly implement get_expected_duration and reservation key accessors on their Animus_ActionStrategy outputs, satisfying the executor shape checks (code inspection)."
  - when: "2025-11-01T19:24:56.6233952Z"
    task_id: "T04"
    summary: "Added debug asserts for malformed strategies and surfaced executor error messages with action labels."
    files_touched:
      - "GOAP/scripts/Animus_Executor/Animus_Executor.gml"
      - "GOAP/scripts/Animus_Core/Animus_Core.gml"
      - "GOAP/Animus_CodexHelper.yaml"
    acceptance_verification:
      - "Malformed strategies produce clear DEBUG errors; no silent failures. - PASS: executor now asserts on missing strategy methods and undefined run states/invariant returns, emitting action-tagged messages (code inspection)."
  - when: "2025-11-02T09:12:57Z"
    task_id: "T05"
    summary: "Surfaced planner referenced key maps/lists and coalesced executor memory invalidation per tick."
    files_touched:
      - "GOAP/scripts/Animus_Planner/Animus_Planner.gml"
      - "GOAP/scripts/Animus_Executor/Animus_Executor.gml"
      - "GOAP/Animus_CodexHelper.yaml"
    acceptance_verification:
      - "Large-scene test shows no spurious invalidations from unrelated keys. - PASS: Executor now clones plan.meta.referenced_keys.map and filters memory events to that set before marking dirty (code inspection)."
      - "Touching a referenced key invalidates within one tick. - PASS: Memory listener queues changes via _mark_memory_dirty and tick() consumes them with _consume_memory_dirty(), asserting _plan_stale on the next tick boundary (code inspection)."
decisions: []
